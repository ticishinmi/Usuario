unit UDM;

interface

uses
  SysUtils, Classes, IBCustomDataSet, IBUpdateSQL, DB, IBQuery, IBDatabase,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf,
  FireDAC.Phys.Intf, FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async,
  FireDAC.Phys, FireDAC.Comp.Client, FireDAC.VCLUI.Wait, FireDAC.Comp.UI,
  FireDAC.Phys.IBBase, FireDAC.Phys.FB, frxCross, frxClass, frxCrypt, frxGZip,
  frxRich, frxBarcode, frxChart, frxGradient, frxDesgn, frxDMPExport,
  frxExportImage, frxExportText, frxExportRTF, frxExportPDF, Graphics, Dialogs,
  System.DateUtils, FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf,
  FireDAC.DApt, FireDAC.Comp.DataSet, Datasnap.Provider, Datasnap.DBClient;

type
  TDM = class(TDataModule)
    Connection: TFDConnection;
    Transaction: TFDTransaction;
    FDPhysFBDriverLink1: TFDPhysFBDriverLink;
    FDGUIxWaitCursor1: TFDGUIxWaitCursor;
    QuGerarID: TFDQuery;
    QuBuscarString: TFDQuery;
    QuBuscaCalcFields: TFDQuery;
    QuBusca: TFDQuery;
    cdsItAuditoria: TClientDataSet;
    cdsItAuditoriaCODIGO: TIntegerField;
    cdsItAuditoriaCODAUDITORIA: TIntegerField;
    cdsItAuditoriaCAMPO: TStringField;
    cdsItAuditoriaTITULO: TStringField;
    cdsItAuditoriaVALORANTERIOR: TStringField;
    cdsItAuditoriaVALORNOVO: TStringField;
    dsItAuditoria: TDataSource;
    dspItAuditoria: TDataSetProvider;
    fqItAuditoria: TFDQuery;
    IBAdmin: TIBDatabase;
    Transacao: TIBTransaction;
    TBUsuario: TIBQuery;
    TBUsuarioGADO_COD: TIntegerField;
    TBUsuarioGADO_NASC: TDateField;
    TBUsuarioGADO_OBS: TBlobField;
    TBUsuarioGADO_DATACAD: TDateField;
    TBUsuarioGADO_STATUS: TIBStringField;
    TBUsuarioGADO_SEXO: TIBStringField;
    TBUsuarioGADO_LOCAL: TIBStringField;
    TBUsuarioGADO_NUM: TIntegerField;
    TBUsuarioGADO_MAE: TIntegerField;
    TBUsuarioGADO_NMAE: TIntegerField;
    TBUsuarioGADO_PELAGEM: TIBStringField;
    TBUsuarioGADO_RACA: TIBStringField;
    TBUsuarioGADO_SITUACAO: TIBStringField;
    TBUsuarioGADO_PROP_COD: TIntegerField;
    TBUsuarioGADO_CRIA: TIBStringField;
    TBUsuarioGADO_MES: TLargeintField;
    TBUsuarioGADO_MESES: TLargeintField;
    TBUsuarioGADO_ANOS: TLargeintField;
    TBUsuarioidade: TStringField;
    TBUsuarioGADO_QTBEZ: TIntegerField;
    TBUsuarioGADO_CLASS: TIBStringField;
    TBUsuarioGADO_CLASSIFICAO: TIBStringField;
    TBUsuarioGADO_REP: TIBStringField;
    TBUsuarioGADO_DTFINAL: TDateField;
    TBUsuarioGADO_IDADEATUAL: TLargeintField;
    DsUsuario: TDataSource;
    IbUsuario: TIBUpdateSQL;
    TbAuditoria: TIBQuery;
    IntegerField1: TIntegerField;
    DateField1: TDateField;
    BlobField1: TBlobField;
    DateField2: TDateField;
    IBStringField1: TIBStringField;
    IBStringField2: TIBStringField;
    IBStringField3: TIBStringField;
    IntegerField2: TIntegerField;
    IntegerField3: TIntegerField;
    IntegerField4: TIntegerField;
    IBStringField4: TIBStringField;
    IBStringField5: TIBStringField;
    IBStringField6: TIBStringField;
    IntegerField5: TIntegerField;
    IBStringField7: TIBStringField;
    LargeintField1: TLargeintField;
    LargeintField2: TLargeintField;
    LargeintField3: TLargeintField;
    StringField1: TStringField;
    IntegerField6: TIntegerField;
    IBStringField8: TIBStringField;
    IBStringField9: TIBStringField;
    IBStringField10: TIBStringField;
    DateField3: TDateField;
    LargeintField4: TLargeintField;
    DsAuditoria: TDataSource;
    IbAuditoria: TIBUpdateSQL;
    procedure TBUsuarioAfterPost(DataSet: TDataSet);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  DM: TDM;

implementation

uses UFuncao;

{$R *.dfm}

procedure TDM.TBUsuarioAfterPost(DataSet: TDataSet);
begin
  try
      if  DM.Transacao.InTransaction then
        DM.Transacao.CommitRetaining;
  except
      DM.Transacao.RollbackRetaining;
  end;

end;

end.
